# ==============================================================================
# BAM Baseline Scenario Validation Targets
# ==============================================================================
#
# Target metrics derived from Delli Gatti et al. (2011), Section 3.9.1
# "Macroeconomics from the Bottom-up" baseline scenario results.
#
# These targets define acceptance criteria for validating that the BAM Engine
# replicates the qualitative and quantitative behavior of the original model.
#
# ==============================================================================

# ── METADATA ─────────────────────────────────────────────────────────────────

metadata:
  source: "Delli Gatti et al. (2011), Section 3.9.1"
  description: "Baseline scenario validation targets"

  # Book simulation setup (reference)
  book_setup:
    n_firms: 100
    n_households: 500
    n_banks: 10
    n_periods: 1000                 # 250 years × 4 quarters
    workers_per_firm: 5.0           # 500/100
    labor_productivity: 0.5

  # Our simulation setup
  our_setup:
    n_firms: 300
    n_households: 3000
    n_banks: 10
    n_periods: 1000
    workers_per_firm: 10.0          # 3000/300
    labor_productivity: 0.5

  # Scaling factors
  scaling:
    population_ratio: 6.0           # 3000/500 households
    firm_size_ratio: 2.0            # 10/5 workers per firm
    log_gdp_offset: 1.79            # ln(6) ≈ 1.79

  # Validation parameters
  validation:
    burn_in_periods: 500            # Exclude initial transients
    extreme_violation_threshold: 0.10  # Max 10% of periods outside extreme bounds


# ── TIME SERIES TARGETS ──────────────────────────────────────────────────────
#
# Each metric includes:
#   - normal_min/max: Bounds for ~90% of periods (after burn-in)
#   - extreme_min/max: Hard bounds, <10% violations acceptable
#   - mean_target: Expected mean value
#   - mean_tolerance: Acceptable deviation from mean (±)
#   - std_target: Expected standard deviation (where measurable)
#   - std_tolerance: Acceptable deviation from std (±)
#
# Note: All values are for steady-state (post burn-in) unless noted.

time_series:

  # --------------------------------------------------------------------------
  # Unemployment Rate
  # --------------------------------------------------------------------------
  # Scale-invariant ratio (same for book and our setup)
  #
  # Book figure (b): Range 0.02-0.12, clusters around 0.05-0.06
  #
  unemployment_rate:
    description: "Fraction of households without employment"
    unit: "ratio"
    scales_with_population: false

    book_values:
      range_min: 0.02
      range_max: 0.12
      mean: 0.055

    targets:
      normal_min: 0.03              # 3% - typical lower bound
      normal_max: 0.09              # 9% - typical upper bound
      extreme_min: 0.01             # 1% - rare boom
      extreme_max: 0.15             # 15% - severe crisis acceptable rarely
      mean_target: 0.055            # 5.5% average unemployment
      mean_tolerance: 0.015         # ± 1.5 percentage points
      std_target: 0.02              # Volatility estimate
      std_tolerance: 0.01

  # --------------------------------------------------------------------------
  # Inflation Rate (Yearly/Annualized)
  # --------------------------------------------------------------------------
  # Scale-invariant ratio
  #
  # Book figure (c): After burn-in, range -0.05 to 0.10, mean ~0.05
  #
  inflation_rate:
    description: "Period-over-period price change rate"
    unit: "ratio"
    scales_with_population: false

    book_values:
      range_min: -0.05
      range_max: 0.10
      mean: 0.05

    targets:
      normal_min: -0.01              # -1% - mild deflation rare in steady state
      normal_max: 0.08              # 8% - typical upper bound
      extreme_min: -0.05            # -5% - deflation during severe crisis
      extreme_max: 0.15             # 15% - inflation spike acceptable rarely
      mean_target: 0.05             # 5% average inflation
      mean_tolerance: 0.02          # ± 2 percentage points
      std_target: 0.025             # Volatility estimate
      std_tolerance: 0.01

  # --------------------------------------------------------------------------
  # Log GDP (Log Output)
  # --------------------------------------------------------------------------
  # SCALES with population: add ln(6) ≈ 1.79 to book values
  #
  # Book figure (a): Range 5.40-5.50, mean ~5.45
  # Our setup: Range 7.19-7.29, mean ~7.24
  #
  # Interpretation: exp(5.45) ≈ 233 units for book (94% of 500 × 0.5)
  #                 exp(7.24) ≈ 1395 units for us (93% of 3000 × 0.5)
  #
  log_gdp:
    description: "Natural log of total production (real GDP)"
    unit: "log units"
    scales_with_population: true

    book_values:
      range_min: 5.40
      range_max: 5.50
      mean: 5.45

    # Scaled targets for our setup (300 firms, 3000 households)
    targets:
      normal_min: 7.22              # log(1365) - 91% employment
      normal_max: 7.28              # log(1455) - 97% employment
      extreme_min: 7.10             # log(1212) - 81% employment (severe crisis)
      extreme_max: 7.30             # log(1480) - 99% employment (boom)
      mean_target: 7.25             # log(1410) - ~94% employment
      mean_tolerance: 0.03          # ± 0.03 log units (~3% output variation)
      std_target: 0.02              # Volatility in log output
      std_tolerance: 0.01

    # Scaling formula for other population sizes
    scaling_formula: "book_value + ln(n_households / 500)"

  # --------------------------------------------------------------------------
  # Real Wage
  # --------------------------------------------------------------------------
  # Scale-invariant ratio
  #
  # Book figure (d): Range 0.30-0.50, mean ~0.33-0.35
  # Red line at 0.5 represents labor productivity
  # Real wage is ~66-70% of labor productivity
  #
  real_wage:
    description: "Average nominal wage divided by price level"
    unit: "ratio"
    scales_with_population: false

    book_values:
      range_min: 0.30
      range_max: 0.50
      mean: 0.34

    targets:
      normal_min: 0.30              # 30% - lower bound, profits squeezed
      normal_max: 0.40              # 40% - upper bound
      extreme_min: 0.25             # 25% - severe wage compression
      extreme_max: 0.45             # 45% - very high wage share
      mean_target: 0.34             # 34% - real wage as fraction of productivity
      mean_tolerance: 0.03          # ± 3 percentage points
      std_target: 0.02              # Volatility estimate
      std_tolerance: 0.01

    # Relationship to labor productivity
    wage_to_productivity_ratio:
      target: 0.68                  # 0.34 / 0.5 = 68% of productivity goes to wages
      min: 0.60
      max: 0.80


# ── MACROECONOMIC CURVE TARGETS ──────────────────────────────────────────────
#
# Each curve includes:
#   - correlation_target: Expected Pearson correlation coefficient
#   - correlation_min/max: Acceptable correlation range
#   - x_range, y_range: Expected data ranges (for sanity checks)
#
# Correlations are dimensionless and do not scale with population.

curves:

  # --------------------------------------------------------------------------
  # Phillips Curve (Wage Inflation vs Unemployment)
  # --------------------------------------------------------------------------
  # Classic negative relationship: higher unemployment → lower wage growth
  #
  # Book figure (a): Weak negative correlation, r = -0.10
  # Wide scatter is expected - relationship is noisy in agent-based models
  #
  phillips:
    description: "Wage inflation rate vs unemployment rate"
    x_variable: "unemployment_rate"
    y_variable: "wage_inflation_rate"

    book_values:
      correlation: -0.10            # From book text

    targets:
      correlation_target: -0.10
      correlation_min: -0.30        # Stronger negative still acceptable
      correlation_max: 0.05         # Weak positive would be concerning
      r_squared_min: 0.005          # Very low R² expected (noisy relationship)

    # Data range sanity checks (from book figure)
    expected_ranges:
      x_min: 0.02
      x_max: 0.12
      y_min: -0.05
      y_max: 0.05

  # --------------------------------------------------------------------------
  # Okun Curve (Output Growth vs Unemployment Growth)
  # --------------------------------------------------------------------------
  # Strong negative relationship: output and unemployment move oppositely
  #
  # Book figure (b): Very tight negative correlation, r ≈ -0.90
  # This is the strongest relationship in the model
  #
  okun:
    description: "Output growth rate vs unemployment growth rate"
    x_variable: "unemployment_growth_rate"
    y_variable: "output_growth_rate"

    book_values:
      correlation: -0.85            # Visual estimate from very tight scatter

    targets:
      correlation_target: -0.85
      correlation_min: -0.98        # Near-perfect negative correlation
      correlation_max: -0.70        # Still strong if slightly weaker
      r_squared_min: 0.50           # At least 50% variance explained

    # Data range sanity checks (from book figure)
    expected_ranges:
      x_min: -0.40
      x_max: 1.00
      y_min: -0.05
      y_max: 0.02

  # --------------------------------------------------------------------------
  # Beveridge Curve (Vacancy Rate vs Unemployment)
  # --------------------------------------------------------------------------
  # Moderate negative relationship: more vacancies when unemployment is low
  #
  # Book figure (c): Moderate negative correlation, r = -0.27
  #
  beveridge:
    description: "Vacancy rate vs unemployment rate"
    x_variable: "unemployment_rate"
    y_variable: "vacancy_rate"

    book_values:
      correlation: -0.27            # From book text

    targets:
      correlation_target: -0.27
      correlation_min: -0.50        # Stronger negative acceptable
      correlation_max: -0.10        # Weak negative still valid
      r_squared_min: 0.05           # Low R² expected

    # Data range sanity checks (from book figure)
    expected_ranges:
      x_min: 0.00
      x_max: 0.14
      y_min: 0.08
      y_max: 0.20


# ── DISTRIBUTION TARGETS ─────────────────────────────────────────────────────
#
# Firm size distribution at end of simulation.
# SCALES with population: threshold values scale with workers_per_firm ratio.

distributions:

  # --------------------------------------------------------------------------
  # Firm Size Distribution (Final Period Production)
  # --------------------------------------------------------------------------
  # Highly right-skewed: many small firms, few large firms
  #
  # Book figure (d): Mode ~2, range 1-8, ~92% below 2.5
  # Our setup: Mode ~4, range 2-16, ~92% below 5.0 (scaled by 2x)
  #
  firm_size:
    description: "Distribution of firm production at final period"
    unit: "production units"
    scales_with_population: true

    book_values:
      mode: 2.0
      range_min: 1.0
      range_max: 8.0
      pct_below_2_5: 0.92           # ~92 of 100 firms below 2.5

    # Scaled targets for our setup (2x workers per firm → 2x production)
    targets:
      # Shape metrics
      skewness_min: 1.0             # Positive skewness (right-skewed)
      skewness_target: 2.0          # Strong right skew
      skewness_max: 5.0             # Very heavy right tail acceptable

      # Percentile-based thresholds (scaled by 2x)
      threshold_small: 5.0          # Book: 2.5 → Our: 5.0
      pct_below_small_target: 0.90  # 90% of firms should be "small"
      pct_below_small_min: 0.80     # At least 80%
      pct_below_small_max: 0.95     # At most 95%

      threshold_medium: 10.0        # Book: 5.0 → Our: 10.0
      pct_below_medium_target: 0.98 # 98% below medium threshold

      # Mode should be in lower range
      mode_min: 3.0                 # Book: 1.5 → Our: 3.0
      mode_max: 6.0                 # Book: 3.0 → Our: 6.0

    # Scaling formula for other population sizes
    scaling_formula: "book_threshold * (n_households / n_firms) / 5"


# ── VACANCY RATE TARGETS ─────────────────────────────────────────────────────
#
# Additional time series metric visible in Beveridge curve
#
  vacancy_rate:
    description: "Total vacancies divided by total households"
    unit: "ratio"
    scales_with_population: false

    book_values:
      range_min: 0.08
      range_max: 0.20
      mean: 0.13

    targets:
      normal_min: 0.08              # 8% - tight labor market
      normal_max: 0.18              # 18% - many unfilled positions
      extreme_min: 0.05             # 5% - very tight market
      extreme_max: 0.25             # 25% - labor shortage
      mean_target: 0.13             # 13% average vacancy rate
      mean_tolerance: 0.03          # ± 3 percentage points


# ── DERIVED METRICS ──────────────────────────────────────────────────────────
#
# Calculated from primary metrics for additional validation
#

derived_metrics:

  # Employment rate = 1 - unemployment_rate
  employment_rate:
    formula: "1 - unemployment_rate"
    target: 0.945                   # 94.5% employment
    tolerance: 0.015

  # Output per employed worker (should equal labor productivity)
  output_per_worker:
    formula: "exp(log_gdp) / (n_households * employment_rate)"
    target: 0.5                     # Equal to labor_productivity parameter
    tolerance: 0.05

  # Wage share of output
  wage_share:
    formula: "real_wage / labor_productivity"
    target: 0.68                    # 68% of output goes to wages
    min: 0.60
    max: 0.80
