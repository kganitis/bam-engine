# ==============================================================================
# BAM Growth+ Scenario Validation Targets
# ==============================================================================
#
# Target metrics derived from Delli Gatti et al. (2011), Section 3.9.2
# "Macroeconomics from the Bottom-up" Growth+ extension scenario results.
#
# The Growth+ scenario introduces endogenous productivity growth through R&D
# investment. Key differences from baseline:
# - Productivity grows over time (non-stationary)
# - Phillips correlation is stronger (-0.19 vs -0.10)
# - Alternating booms and recessions along growth path
# - Firm size distribution has larger production values due to productivity growth
#
# ==============================================================================

# -- METADATA -----------------------------------------------------------------

metadata:
  source: "Delli Gatti et al. (2011), Section 3.9.2"
  description: "Growth+ scenario validation targets - Endogenous Productivity Growth"

  # Book and our setup are identical (no scaling needed)
  setup:
    n_firms: 100
    n_households: 500
    n_banks: 10
    n_periods: 1000                 # 250 years x 4 quarters
    workers_per_firm: 5.0           # 500/100
    initial_labor_productivity: 0.5

  # R&D extension parameters
  extension_params:
    sigma_min: 0.0                  # R&D share for highest fragility firms
    sigma_max: 0.1                  # R&D share for lowest fragility firms
    sigma_decay: -1.0               # Decay rate (negative = higher fragility -> lower R&D)

  # Validation parameters
  validation:
    burn_in_periods: 500            # Exclude initial transients
    extreme_violation_threshold: 0.10  # Max 10% of periods outside extreme bounds


# -- TIME SERIES TARGETS ------------------------------------------------------
#
# Each metric includes:
#   - book_values: Reference values from book figures
#   - targets: Validation criteria
#     - normal_min/max: Bounds for ~90% of periods (after burn-in)
#     - extreme_min/max: Hard bounds, <10% violations acceptable
#     - mean_target: Expected mean value
#     - mean_tolerance: Acceptable deviation from mean (+/-)
#     - std_target: Expected standard deviation
#     - std_tolerance: Acceptable deviation from std (+/-)
#
# Note: All values are for steady-state (post burn-in) unless noted.

time_series:

  # --------------------------------------------------------------------------
  # Unemployment Rate
  # --------------------------------------------------------------------------
  # Scale-invariant ratio. Higher volatility than baseline with multiple
  # crisis episodes reaching 14%.
  #
  # Book figure (b): Range 0.01-0.14, cyclical pattern with crisis spikes
  #
  unemployment_rate:
    description: "Fraction of households without employment"
    unit: "ratio"
    scales_with_population: false

    book_values:
      range_min: 0.01
      range_max: 0.14
      mean: 0.055

    targets:
      normal_min: 0.01              # 1% - tight labor market during booms
      normal_max: 0.12              # 12% - high unemployment during recessions
      extreme_min: 0.00             # 0% - rare full employment
      extreme_max: 0.15             # 15% - severe crisis
      mean_target: 0.055            # 5.5% average unemployment
      mean_tolerance: 0.02          # +/- 2 percentage points
      std_target: 0.03              # Higher volatility than baseline
      std_tolerance: 0.015

  # --------------------------------------------------------------------------
  # Inflation Rate (Yearly/Annualized)
  # --------------------------------------------------------------------------
  # Scale-invariant ratio. More volatile than baseline with deeper deflation
  # during crises.
  #
  # Book figure (c): Range -0.06 to 0.14, counter-cyclical to unemployment
  #
  inflation_rate:
    description: "Period-over-period price change rate"
    unit: "ratio"
    scales_with_population: false

    book_values:
      range_min: -0.06
      range_max: 0.14
      mean: 0.04

    targets:
      normal_min: -0.02             # -2% - mild deflation during crises
      normal_max: 0.10              # 10% - inflation during booms
      extreme_min: -0.06            # -6% - severe deflation
      extreme_max: 0.15             # 15% - inflation spike
      mean_target: 0.04             # 4% average inflation
      mean_tolerance: 0.025         # +/- 2.5 percentage points
      std_target: 0.03              # Higher volatility than baseline
      std_tolerance: 0.015

  # --------------------------------------------------------------------------
  # Log GDP (Log Output)
  # --------------------------------------------------------------------------
  # GROWS over time due to productivity growth. Range expands post burn-in.
  #
  # Book figure (a): Range 8.4-9.25 over 500 periods, clear upward trend
  #
  log_gdp:
    description: "Natural log of total production (real GDP) - GROWING"
    unit: "log units"
    scales_with_population: false   # Book values used directly

    book_values:
      initial: 8.4                  # At t=0
      final: 9.25                   # At t=500
      growth_per_period: 0.0017     # Approximate linear trend

    targets:
      normal_min: 8.6               # After burn-in, growth has occurred
      normal_max: 9.3
      extreme_min: 8.4
      extreme_max: 9.4
      mean_target: 8.95             # Mid-range after burn-in
      mean_tolerance: 0.15          # Wider tolerance due to growth trend
      # Growth-specific targets
      trend_coefficient_min: 0.001  # Minimum growth rate
      trend_coefficient_max: 0.003  # Maximum growth rate

  # --------------------------------------------------------------------------
  # Productivity (Production-weighted average)
  # --------------------------------------------------------------------------
  # GROWS over time due to R&D investment. Upper line in book figure (d).
  #
  # Book figure (d) upper line: Range 10-22 over 500 periods
  #
  productivity:
    description: "Production-weighted average labor productivity - GROWING"
    unit: "output per worker"
    scales_with_population: false

    book_values:
      initial: 10
      final: 22
      growth_rate: 1.2              # ~120% total growth

    targets:
      initial_min: 8
      initial_max: 12
      final_min: 18
      final_max: 25
      total_growth_min: 0.8         # At least 80% growth
      total_growth_max: 2.5         # At most 250% growth
      trend_coefficient_min: 0.001
      trend_coefficient_max: 0.004

  # --------------------------------------------------------------------------
  # Real Wage
  # --------------------------------------------------------------------------
  # GROWS over time alongside productivity. Lower line in book figure (d).
  #
  # Book figure (d) lower line: Range 6.5-15 over 500 periods
  #
  real_wage:
    description: "Average real wage of employed workers - GROWING"
    unit: "wage units"
    scales_with_population: false

    book_values:
      initial: 6.5
      final: 15
      growth_rate: 1.3              # ~130% total growth

    targets:
      initial_min: 5
      initial_max: 8
      final_min: 12
      final_max: 18
      total_growth_min: 0.8         # At least 80% growth
      total_growth_max: 2.5         # At most 250% growth


# -- MACROECONOMIC CURVE TARGETS ----------------------------------------------
#
# Each curve includes:
#   - book_values: Reference correlation from book
#   - targets: Validation criteria
#     - correlation_target: Expected Pearson correlation coefficient
#     - correlation_min/max: Acceptable correlation range
#   - expected_ranges: Data ranges for sanity checks
#
# Correlations are dimensionless and do not scale with population.

curves:

  # --------------------------------------------------------------------------
  # Phillips Curve (Wage Inflation vs Unemployment)
  # --------------------------------------------------------------------------
  # STRONGER negative correlation than baseline (-0.19 vs -0.10)
  #
  # Book figure (a) of curves: Clear negative slope with scatter
  #
  phillips:
    description: "Wage inflation rate vs unemployment rate"
    x_variable: "unemployment_rate"
    y_variable: "wage_inflation_rate"

    book_values:
      correlation: -0.19            # Stronger than baseline's -0.10

    targets:
      correlation_target: -0.19
      correlation_min: -0.35        # Stronger negative still acceptable
      correlation_max: -0.05        # Must be negative
      r_squared_min: 0.02           # Low R^2 expected (noisy relationship)

    expected_ranges:
      x_min: 0.00
      x_max: 0.14
      y_min: -0.10
      y_max: 0.04

  # --------------------------------------------------------------------------
  # Okun Curve (Output Growth vs Unemployment Growth)
  # --------------------------------------------------------------------------
  # Strong negative relationship, similar to baseline
  #
  # Book figure (b) of curves: Tight negative correlation
  #
  okun:
    description: "Output growth rate vs unemployment growth rate"
    x_variable: "unemployment_growth_rate"
    y_variable: "output_growth_rate"

    book_values:
      correlation: -0.85            # Strong negative relationship

    targets:
      correlation_target: -0.85
      correlation_min: -0.98        # Near-perfect negative correlation
      correlation_max: -0.70        # Still strong if slightly weaker
      r_squared_min: 0.50           # At least 50% variance explained

    expected_ranges:
      x_min: -1.0
      x_max: 5.0
      y_min: -0.12
      y_max: 0.04

  # --------------------------------------------------------------------------
  # Beveridge Curve (Vacancy Rate vs Unemployment)
  # --------------------------------------------------------------------------
  # Moderate negative relationship, similar to baseline
  #
  # Book figure (c) of curves: Downward sloping scatter
  #
  beveridge:
    description: "Vacancy rate vs unemployment rate"
    x_variable: "unemployment_rate"
    y_variable: "vacancy_rate"

    book_values:
      correlation: -0.27            # Moderate negative relationship

    targets:
      correlation_target: -0.27
      correlation_min: -0.50        # Stronger negative acceptable
      correlation_max: -0.10        # Weak negative still valid
      r_squared_min: 0.05           # Low R^2 expected

    expected_ranges:
      x_min: 0.00
      x_max: 0.14
      y_min: 0.08
      y_max: 0.20


# -- DISTRIBUTION TARGETS -----------------------------------------------------
#
# Firm size distribution at end of simulation.
# Much larger production values than baseline due to productivity growth.

distributions:

  # --------------------------------------------------------------------------
  # Firm Size Distribution (Final Period Production)
  # --------------------------------------------------------------------------
  # Production values are MUCH LARGER than baseline (50-350 vs 1-10)
  # due to accumulated productivity growth over 1000 periods.
  #
  # Book figure (d) of distributions: Mode at ~100-125, range 50-350
  #
  firm_size:
    description: "Distribution of firm production at final period - LARGER due to growth"
    unit: "production units"
    scales_with_population: false

    book_values:
      mode: 100                     # Mode production value
      range_min: 50
      range_max: 500
      pct_below_150: 0.90           # ~90% of firms below 150

    targets:
      # Shape metrics
      skewness_min: 0.5             # Must be right-skewed (strict)
      skewness_target: 2.0          # Typical value
      skewness_max: 10.0            # Allow for outlier firms (relaxed)

      # Percentile-based thresholds
      threshold_small: 150.0        # "Small" firm threshold
      pct_below_small_target: 0.90  # 90% of firms should be "small"
      pct_below_small_min: 0.70     # At least 70%
      pct_below_small_max: 0.95     # At most 95%

      # Mode should be in middle range
      mode_min: 75
      mode_max: 150

  # --------------------------------------------------------------------------
  # Vacancy Rate Distribution
  # --------------------------------------------------------------------------
  # Similar to baseline
  #
  vacancy_rate:
    description: "Total vacancies divided by total households"
    unit: "ratio"
    scales_with_population: false

    book_values:
      range_min: 0.08
      range_max: 0.20
      mean: 0.12

    targets:
      normal_min: 0.08              # 8% - tight labor market
      normal_max: 0.18              # 18% - many unfilled positions
      extreme_min: 0.05             # 5% - very tight market
      extreme_max: 0.25             # 25% - labor shortage
      mean_target: 0.12             # 12% average vacancy rate
      mean_tolerance: 0.03          # +/- 3 percentage points


# -- DERIVED METRICS ----------------------------------------------------------
#
# Calculated from primary metrics for additional validation
#

derived_metrics:

  # Employment rate = 1 - unemployment_rate
  employment_rate:
    formula: "1 - unemployment_rate"
    target: 0.945                   # 94.5% employment
    tolerance: 0.02

  # Productivity to wage ratio (should stay roughly constant as both grow)
  productivity_wage_ratio:
    formula: "productivity / real_wage"
    target: 1.5                     # Productivity ~1.5x real wage
    tolerance: 0.3


# -- FINANCIAL DYNAMICS TARGETS -----------------------------------------------
#
# Metrics from Figures 3.6 and 3.7 of the book, characterizing business cycles,
# financial fragility, market structure, and Minsky classification.

financial_dynamics:

  # --------------------------------------------------------------------------
  # Output Growth Rate Distribution (Figure 3.6a)
  # --------------------------------------------------------------------------
  # Log-rank plot of GDP growth rates across periods after burn-in.
  # Tent-shaped distribution with negative rates (blue) on left,
  # positive rates (red) on right.
  #
  # Book figure (a): Range -0.12 to 0.08, ~30% negative, ~70% positive
  #
  output_growth_distribution:
    description: "Output growth rate distribution (log-rank plot)"
    unit: "ratio"

    book_values:
      range_min: -0.12
      range_max: 0.08
      negative_pct: 0.30
      positive_pct: 0.70

    targets:
      # Tiered range thresholds
      tight_range_min: -0.05
      tight_range_max: 0.05
      normal_range_min: -0.10
      normal_range_max: 0.10
      extreme_range_min: -0.15
      extreme_range_max: 0.15
      # Percentage targets
      pct_within_tight_target: 0.95
      pct_within_tight_min: 0.90
      pct_within_normal_target: 0.99
      pct_within_normal_min: 0.96
      # Outlier penalty
      max_outlier_pct: 0.02
      outlier_penalty_weight: 2.0
      # Legacy (backward compat)
      range_min: -0.15
      range_max: 0.10
      negative_pct_min: 0.15
      negative_pct_max: 0.45
      positive_pct_min: 0.55
      positive_pct_max: 0.85

  # --------------------------------------------------------------------------
  # Net Worth Growth Rate Distribution (Figure 3.6b)
  # --------------------------------------------------------------------------
  # Log-rank plot of firm-level net worth (asset) growth rates at last period.
  # Cross-sectional distribution showing each firm's asset growth.
  #
  # Book figure (b): Range -0.35 to 0.15, ~40% negative, ~60% positive
  #
  networth_growth_distribution:
    description: "Firm-level net worth growth rate distribution"
    unit: "ratio"

    book_values:
      range_min: -0.35
      range_max: 0.15
      negative_pct: 0.40
      positive_pct: 0.60

    targets:
      # Tiered range thresholds
      tight_range_min: -0.05
      tight_range_max: 0.05
      normal_range_min: -0.10
      normal_range_max: 0.10
      extreme_range_min: -0.50
      extreme_range_max: 0.20
      # Percentage targets
      pct_within_tight_target: 0.75
      pct_within_tight_min: 0.60
      pct_within_normal_target: 0.90
      pct_within_normal_min: 0.80
      # Outlier penalty
      max_outlier_pct: 0.05
      outlier_penalty_weight: 2.0
      # Legacy (backward compat)
      range_min: -0.50
      range_max: 0.20
      negative_pct_min: 0.15
      negative_pct_max: 0.50
      positive_pct_min: 0.50
      positive_pct_max: 0.85

  # --------------------------------------------------------------------------
  # Number of Firm Bankruptcies (Figure 3.6d)
  # --------------------------------------------------------------------------
  # Bankruptcies per period show spikes during recessions.
  #
  # Book figure (d): Range 0-7, typical 1-3
  #
  bankruptcies:
    description: "Number of firm bankruptcies per period"
    unit: "count"
    scales_with_population: true

    book_values:
      range_min: 0
      range_max: 7
      typical: 2

    targets:
      mean_target: 2.0
      mean_tolerance: 1.5
      extreme_max: 10

  # --------------------------------------------------------------------------
  # Real Interest Rate (Figure 3.6c)
  # --------------------------------------------------------------------------
  # Weighted average real interest rate across active loans.
  #
  # Book figure (c): Range -0.04 to 0.14, oscillates around mean ~0.05
  # Most values fall between 0.02 and 0.08 (normal range).
  #
  real_interest_rate:
    description: "Weighted average real interest rate"
    unit: "ratio"
    scales_with_population: false

    book_values:
      range_min: -0.04
      range_max: 0.14
      mean: 0.05
      std: 0.02

    targets:
      mean_target: 0.05
      mean_tolerance: 0.02
      std_target: 0.02
      std_tolerance: 0.01
      normal_min: 0.00              # 0% - most values above this
      normal_max: 0.10              # 10% - most values below this
      extreme_min: -0.05            # -5% - hard lower bound
      extreme_max: 0.15             # 15% - hard upper bound

  # --------------------------------------------------------------------------
  # Financial Fragility (Figure 3.7a)
  # --------------------------------------------------------------------------
  # Total wage bill / total net worth ratio for the economy.
  # Increases before recessions, decreases during.
  #
  # Book figure (a): Range 0.05-0.12, procyclical pattern
  #
  financial_fragility:
    description: "Average wage-bill to equity ratio"
    unit: "ratio"
    scales_with_population: false

    book_values:
      range_min: 0.05
      range_max: 0.12
      mean: 0.08
      std: 0.015

    targets:
      mean_target: 0.08
      mean_tolerance: 0.03
      std_target: 0.015
      std_tolerance: 0.01
      normal_min: 0.05
      normal_max: 0.12
      extreme_min: 0.02
      extreme_max: 0.15

  # --------------------------------------------------------------------------
  # Price Ratio (Figure 3.7b)
  # --------------------------------------------------------------------------
  # Ratio of market price to market-clearing price (P / P*).
  # Measures market power; decreases during expansions, increases in recessions.
  #
  # Book figure (b): Range 1.1-1.7, countercyclical
  #
  price_ratio:
    description: "Ratio of market price to market-clearing price"
    unit: "ratio"
    scales_with_population: false

    book_values:
      range_min: 1.1
      range_max: 1.7
      mean: 1.35
      std: 0.13

    targets:
      mean_target: 1.35
      mean_tolerance: 0.15
      std_target: 0.13
      std_tolerance: 0.05
      normal_min: 1.1
      normal_max: 1.8
      extreme_min: 1.0
      extreme_max: 2.0

  # --------------------------------------------------------------------------
  # Price Dispersion (Figure 3.7c)
  # --------------------------------------------------------------------------
  # Coefficient of variation of posted prices.
  # Decreases during recessions as bankruptcies reduce heterogeneity.
  #
  # Book figure (c): Range 0.18-0.38
  #
  price_dispersion:
    description: "Coefficient of variation of prices"
    unit: "ratio"
    scales_with_population: false

    book_values:
      range_min: 0.18
      range_max: 0.38
      mean: 0.28
      std: 0.05

    targets:
      mean_target: 0.28
      mean_tolerance: 0.08
      std_target: 0.05
      std_tolerance: 0.03
      normal_min: 0.20
      normal_max: 0.35
      extreme_min: 0.15
      extreme_max: 0.40

  # --------------------------------------------------------------------------
  # Equity Dispersion (Figure 3.7d - blue line)
  # --------------------------------------------------------------------------
  # Coefficient of variation of net worth.
  # Increases during expansions, decreases during recessions.
  #
  # Book figure (d) blue line: Range 0.5-3.5, procyclical
  #
  equity_dispersion:
    description: "Coefficient of variation of firm net worth"
    unit: "ratio"
    scales_with_population: false

    book_values:
      range_min: 0.5
      range_max: 2.7
      mean: 1.5
      std: 0.6

    targets:
      mean_target: 1.5
      mean_tolerance: 0.5
      std_target: 0.6
      std_tolerance: 0.3
      normal_min: 0.6
      normal_max: 2.5
      extreme_min: 0.3
      extreme_max: 3.0

  # --------------------------------------------------------------------------
  # Sales Dispersion (Figure 3.7d - red line)
  # --------------------------------------------------------------------------
  # Coefficient of variation of production/sales.
  # Similar pattern to equity dispersion.
  #
  # Book figure (d) red line: Range 0.5-3.5, procyclical
  #
  sales_dispersion:
    description: "Coefficient of variation of firm sales"
    unit: "ratio"
    scales_with_population: false

    book_values:
      range_min: 0.5
      range_max: 3.5
      mean: 1.5
      std: 0.8

    targets:
      mean_target: 1.5
      mean_tolerance: 0.5
      std_target: 0.8
      std_tolerance: 0.4
      normal_min: 0.5
      normal_max: 3.0
      extreme_min: 0.3
      extreme_max: 3.5

  # --------------------------------------------------------------------------
  # Minsky Classification (averaged over post-burn-in periods)
  # --------------------------------------------------------------------------
  # Firms classified by financial stability using total_funds vs debt/interest:
  # - Hedge: total_funds >= debt (can pay principal + interest)
  # - Speculative: interest <= total_funds < debt (can pay interest but not full debt)
  # - Ponzi: total_funds < interest (cannot even pay interest)
  #
  # Book text: ~2/3 Hedge, <1/10 Ponzi
  #
  minsky_classification:
    description: "Firm financial stability taxonomy"

    book_values:
      hedge_pct: 0.67
      speculative_pct: 0.23
      ponzi_pct: 0.10

    targets:
      hedge_pct_target: 0.67
      hedge_pct_min: 0.40
      hedge_pct_max: 0.85
      ponzi_pct_target: 0.10
      ponzi_pct_min: 0.02
      ponzi_pct_max: 0.50
